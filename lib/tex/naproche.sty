\NeedsTeXFormat{LaTeX2e}

\RequirePackage{amsmath}
\RequirePackage{amsthm}
\RequirePackage{amsfonts}
\RequirePackage{etoolbox}
\RequirePackage{braket}     % \Set
\RequirePackage{linegoal}   % \linegoal
\RequirePackage{xspace}     % \xspace
\RequirePackage{xcolor}     % lightgray
\RequirePackage{mdframed}   % \begin{mdframed} ... \end{mdframed}


% Top-level sections
% ==================

\newtheoremstyle{formalized}% name of the style to be used
    {4pt}% measure of space to leave above the theorem. E.g.: 3pt
    {4pt}% measure of space to leave below the theorem. E.g.: 3pt
    {\normalfont} % name of font to use in the body of the theorem
    {0pt}% measure of space to indent
    {\bfseries}% name of head font
    {}% punctuation between head and body
    { }% space after theorem head; " " = normal inter-word space
    {\thmname{#1}\thmnumber{ #2}. \thmnote{ (#3) }}

\theoremstyle{formalized}
\newcounter{theoremcount}

\newtheorem{axiom}[theoremcount]{Axiom}
\newtheorem{corollary}[theoremcount]{Corollary}
\newtheorem{definition}[theoremcount]{Definition}
\newtheorem{fact}[theoremcount]{Fact}
\newtheorem{lemma}[theoremcount]{Lemma}
\newtheorem{proposition}[theoremcount]{Proposition}
\newtheorem{remark}[theoremcount]{Remark}
\newtheorem{signature}[theoremcount]{Signature}
\newtheorem{theorem}[theoremcount]{Theorem}

% Theorem environments without numbering.
\newtheorem*{quotedaxiom}{Axiom}
\newtheorem*{quotedcorollary}{Corollary}
\newtheorem*{quoteddefinition}{Definition}
\newtheorem*{quotedfact}{Fact}
\newtheorem*{quotedlemma}{Lemma}
\newtheorem*{quotedproposition}{Proposition}
\newtheorem*{quotedremark}{Remark}
\newtheorem*{quotedsignature}{Signature}
\newtheorem*{quotedtheorem}{Theorem}


% ForTheL environment
% ===================

% Space between paragraphs in forthel environments
\newlength{\ftlparskip}
\setlength{\ftlparskip}{0.5em}

% ForTheL environment
\newenvironment{forthel}{%
  \begin{mdframed}[backgroundcolor=lightgray!30, linecolor=lightgray!30]%
  \rmfamily%
  \setbool{forthel}{true}%
  \setlength{\parindent}{0pt}%
  \setlength{\parskip}{\ftlparskip}%
}{%
  \end{mdframed}%
  \rmfamily%
  \setbool{forthel}{false}%
}

% Wrapper for ForTheL environments. Warning: In the PDF it looks exactly like
% an ordinary ForTheL environment, but its content is not checked by Naproche.
% So use it wisely!
\newenvironment{greybox}{
  \begin{forthel}
}{
  \end{forthel}
}


% Flexible class terms
% ====================

% Use "\class{ ... | ... }" the same way as "\Set{ ... | ... }" from the braket
% package, i.e. as an alternative to "\{ ... \mid ... \}" with additional
% support for flexible sizes of the braces and the vertical bar.
\def\class{\Set}

% Let "\classtext{...}" behave as "\text{...}" but with automatic linebreaks.
% Intended to be used together with "\class{ ... | ... }" as in
% "\class{ ... | \classtext{...}}".
\newcommand{\classtext}[1]{\parbox{\linegoal}{#1}}


% More visible line breaks in proofs.
% ===================================

\newbool{forthel}

% Set length of \parskip to \ftlparskip in proofs in ForTheL environments.
%
% NOTE: "\vspace*{-\parskip}" is necessary to avoid additional space between
% theorem and proof
\renewenvironment{proof}[1][\unskip]{%
  \ifbool{forthel}{\setlength{\parskip}{\ftlparskip}\vspace*{-\parskip}}%
  \noindent\textit{Proof #1. }%
  \relax%
}
{%
  \hfill\qed
}


% Predefined symbols
% ==================

\newcommand{\dom}{\operatorname{dom}}
\newcommand{\fun}{\mathrm{\lambda}}


% Naproche logo
% =============

\newcommand{\Naproche}{\ensuremath{\mathbb{N}}aproche\xspace}


% Options
% =======

% If the option 'nonumbers' is activated, then all the theorem environment are left unnumbered.
\DeclareOption{nonumbers}{%
    \renewcommand{\axiom}{\quotedaxiom}
    \renewcommand{\corollary}{\quotedcorollary}
    \renewcommand{\definition}{\quoteddefinition}
    \renewcommand{\fact}{\quotedfact}
    \renewcommand{\lemma}{\quotedlemma}
    \renewcommand{\proposition}{\quotedproposition}
    \renewcommand{\remark}{\quotedremark}
    \renewcommand{\signature}{\quotedsignature}
    \renewcommand{\theorem}{\quotedtheorem}
}
\DeclareOption{numberswithinsection}{%
    \counterwithin{theoremcount}{section}
}
\DeclareOption{numberswithinsubsection}{%
    \counterwithin{theoremcount}{subsection}
}
\DeclareOption{unmarked}{%
  \renewenvironment{forthel}{%
    \setbool{forthel}{true}%
  }{%
    \setbool{forthel}{false}%
  }
}
\DeclareOption*{\PackageWarning{naproche}{Unknown ‘\CurrentOption’}}
\ProcessOptions\relax
